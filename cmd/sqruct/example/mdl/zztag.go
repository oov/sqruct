// DO NOT EDIT. This file was auto-generated by Sqruct.

package mdl

import (
	"github.com/jmoiron/sqlx"
	"github.com/oov/sqruct"
)

// Tag represents the following table.
// 	CREATE TABLE tag(
// 		id INTEGER PRIMARY KEY,
// 		name VARCHAR(30) NOT NULL UNIQUE
// 	);
type Tag struct {
	ID   int64  `mdl:"pk,notnull,uniq,default,autoincr"`
	Name string `mdl:"notnull,uniq"`
}

func GetTag(e sqlx.Ext, id int64) (*Tag, error) {
	var t Tag
	err := sqlx.Get(e, &t, e.Rebind("SELECT * FROM tag WHERE (id = ?)"), id)
	if err != nil {
		return nil, err
	}
	return &t, nil
}

func (t *Tag) SelectPostTag(e sqlx.Ext) ([]PostTag, error) {
	var ot []PostTag
	err := sqlx.Select(e, &ot, e.Rebind("SELECT * FROM posttag WHERE (tagid = ?)"), t.ID)
	if err != nil {
		return nil, err
	}
	return ot, nil
}

func (t *Tag) Insert(e sqlx.Ext) error {
	z := sqruct.IsZero(t.ID)
	r, err := sqlx.NamedExec(e, sqruct.BuildInsertQuery(
		"tag",
		[]string{"id", "name"},
		[]bool{!z, true},
	), t)
	if err != nil {
		return err
	}
	if z {
		t.ID, err = r.LastInsertId()
		return err
	}
	return nil
}

func (t *Tag) Update(e sqlx.Ext) error {
	_, err := sqlx.NamedExec(e, "UPDATE tag SET name = :name WHERE (id = :id)", t)
	return err
}

func (t *Tag) Delete(e sqlx.Ext) error {
	_, err := sqlx.NamedExec(e, "DELETE FROM tag WHERE (id = :id)", t)
	return err
}
